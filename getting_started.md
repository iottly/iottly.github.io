# Getting Started Project

The Getting Started project demonstrates a simple use case where an Elastic Pi is virtually connected to temperature and humidity sensors, regularly acquiring values from an industrial machine.

## Elastic Pi ?

To let you try the project without the need of a physical Pi, we created an Elastic Pi (a virtual device) and connected it to your *Getting Started* project.

You can see your Elastic Pi from the *Device Configuration* panel, in connected status:

![Device Configuration panel](/images/elastic_pi_getting_started_device_conf.png)

## The code

Move to the *Coding Firmware* panel:

![Coding Firmware panel](/images/elastic_pi_getting_started_code.png)

### Generating sensor data readings

In the demo project the values of the sensors are randomly generated by an ad hoc function defined in the `global` section.

The code is in the `global` section:
```py
def read_data_from_sensor(sensortype):
  """simulates the reading of a sensor randomly generating values"""
  if sensortype == "temperature":
    # randomly generate temperature value 
    return round_reading(random.uniform(30,50))   
  elif sensortype == "humidity":
    # randomly generate humidity value
    return round_reading(random.uniform(20,80))  
```

### Polling for sensor data readings

The main code in the `loop` section, simply polls sensors' data value every 5 sec, as it would do in a real scenario, and stores it in a global variable (as usual defined in the global section):
```py
def loop():
  """the main loop of your device, running on a dedicated process"""

  # this example simply "polls" the temperature value every 5 sec, 
  # storing them in global variables (defined in the global section)

  temp_value.value = read_data_from_sensor("temperature")
  hum_value.value = read_data_from_sensor("humidity")
  
  time.sleep(5)
```

## Messages to remotely interacting with the Pis

Move to the `Messages` panel:
![Messages panel](/images/elastic_pi_getting_started_Messages.png)

### Interactively ask the Pi for sensor readings

Let's say we want to remotely ask the Pi for the temperature and/or humidity value. 
What we need is a command and the code to handle it.

The command has been defined with the following structure:
```json
{"ask_sensor_data": {"sensortype": "<temperature|humidity|both>"}}
```
Where:
- `ask_sensor_data` is the **message type** describing that we will use this command to ask sensor data to the py
- `sensortype` is a **keyword** accepting 3 possible values, to allow us to ask for temperature, humidity or both.

Iottly automatically generates the command handler for us, all we need to do is to put the logic inside, to get the requested data from the global variables and to send them to Iottly through MQTT:
```py
def read_sensor_data(command):
  """
  function to handle the command read_sensor_data
  command description: Make a sensor data reading
  format of command dict:
  {"read_sensor_data":{"sensortype":"<temperature|humidity|both>"}}
  
  Command handlers run in a dedicated process (one for all)  
  """

  # cmdpars stores the command parameters
  cmdpars = command["read_sensor_data"]
  
  # based on the value of sensortype get the data :
  #   - from temp_value.value, 
  #   - or from hum_value.value
  #   - or from both of them
 
  if (cmdpars["sensortype"] == "temperature"):  
    sensor_data_reading = {"temperaure":temp_value.value}

  elif (cmdpars["sensortype"] == "humidity"):   
    sensor_data_reading = {"humidity": hum_value.value}

  elif (cmdpars["sensortype"] == "both"):
    sensor_data_reading = {
      "temperaure": temp_value.value,
      "humidity": hum_value.value
    }

  # prepare a message as the following:
  # {"sensor_data_reading":{
  #    "temperature": <temp value from temp_value.value>,
  #    "humidity": <hum value from hum_value.value>,
  #  }}      
  message = {"sensor_data_reading": sensor_data_reading}
  
  # finally send the message over MQTT with the built in iottly function    
  send_msg(message)
```
## Try it yourself

### Send an alarm when the temperature is too high


After building the temperature and humidity control program, we send an alarm message when the temperature exceeds the safety limit

###### In the loop section:
```
  if (temp_value.value > 48): # create a contorl cicle
    alarm = dict(description="temperature too high" , temp_value = temp_value.value) # create a dictionary  
    message = dict(ALARM = alarm) # create a new dictionary for print alarm in the landing
    send_msg(message) # send message in the consol pannel 
    
```
